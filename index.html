<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>REZ‚Ä¢oneXD AI</title>

<style>
body{
 color:white;
 font-family:Arial;
 margin:0;
 min-height:100vh;
}

.header{
 display:flex;
 align-items:center;
 justify-content:space-between;
 background:#0f1629;
 padding:12px;
 font-weight:bold
}

.icon{
 width:40px;
 height:40px;
 border-radius:50%;
 margin-right:8px
}

.chat{
 padding:12px;
 height:75vh;
 overflow-y:auto
}

.me{
 background:#3b7bfd;
 padding:10px;
 border-radius:12px;
 margin:8px 0;
 margin-left:auto;
 width:fit-content;
 max-width:85%
}

.bot{
 background:#1f2a44;
 padding:10px;
 border-radius:12px;
 margin:8px 0;
 width:fit-content;
 max-width:85%
}

.footer{
 display:flex;
 padding:10px;
 background:#0f1629;
 gap:6px
}

input{
 flex:1;
 padding:10px;
 border-radius:8px;
 border:none;
 background:#0b1220;
 color:white
}

button{
 padding:10px 14px;
 border-radius:8px;
 border:none;
 background:#3b7bfd;
 color:white
}

.delete-btn{background:#ff4747}

pre{
 background:#0b1220;
 padding:10px;
 border-radius:8px;
 overflow:auto
}

/* ===== BACKGROUND ASLI (BALIK) ===== */

/* DESKTOP */
@media (min-width: 768px){
 body{
  background-color:#f2f3f5;
  background-image:url("https://img1.pixhost.to/images/11662/685570551_dikzz.jpg");
  background-repeat:repeat;
 }
}

/* MOBILE */
@media (max-width: 767px){
 body{
  background-color:#f5f6f8;
  background-image:url("https://img1.pixhost.to/images/11662/685570521_dikzz.jpg");
  background-repeat:repeat;
 }
}
</style>
</head>

<body>

<div class="header">
 <div style="display:flex;align-items:center">
  <img src="https://img1.pixhost.to/images/10993/672136981_dikzz.jpg" class="icon">
  REZ‚Ä¢oneXD AI Chat
 </div>
 <button class="delete-btn" onclick="clearSession()">Hapus Sesi</button>
 <button onclick="logout()" style="background:#ff9f43;color:black">Logout</button>
</div>

<div class="chat" id="chatBox"></div>

<div class="footer">
 <input id="input" placeholder="Ketik pesan...">
 <button onclick="sendMessage()">Kirim</button>
 <button onclick="startVoice()" style="background:#1dd1a1">VN</button>
</div>

<script>
const API = "https://romzi.vercel.app/ai/ciciai?query=";

const SYSTEM_PROMPT = `
Nama kamu REZ‚Ä¢oneXD.
Kamu asisten AI milik Gx Dikzz.
Jangan pernah sebut nama Cici.
Jawab singkat, jelas, tidak mengarang.
`;

let session={history:[]};
const chatBox=document.getElementById("chatBox");
const input=document.getElementById("input");

/* ===== STORAGE ===== */
function load(){
 let s=localStorage.getItem("rezonexd_ai");
 if(s) session=JSON.parse(s);
 render();
}
load();

function save(){
 localStorage.setItem("rezonexd_ai",JSON.stringify(session));
}

function render(){
 chatBox.innerHTML="";
 session.history.forEach(m=>{
  addMessage(m.role==="user"?"me":"bot",m.text);
 });
 chatBox.scrollTop=chatBox.scrollHeight;
}

/* ===== MESSAGE ===== */
function addMessage(type,text){
 let d=document.createElement("div");
 d.className=type;

 if(text.includes("```")){
  d.innerHTML=text.replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>");
 }else{
  d.innerText=text;
 }

 chatBox.appendChild(d);
 chatBox.scrollTop=chatBox.scrollHeight;
}

/* ===== CLEAR ===== */
function clearSession(){
 session.history=[];
 localStorage.removeItem("rezonexd_ai");
 render();
 alert("Sesi direset!");
}

/* ===== SEND MESSAGE ===== */
async function sendMessage(){
 let text=input.value.trim();
 if(!text) return;
 input.value="";

 addMessage("me",text);
 session.history.push({role:"user",text});
 save();

 let typing=document.createElement("div");
 typing.className="bot";
 typing.innerText="‚è≥ REZ‚Ä¢oneXD berpikir...";
 chatBox.appendChild(typing);

 let short=session.history.slice(-3)
  .map(m=>(m.role==="user"?"User: ":"AI: ")+m.text)
  .join("\n");

 try{
  let res=await fetch(API+encodeURIComponent(SYSTEM_PROMPT+"\n"+short+"\nAI:"));
  let data=await res.json();
  typing.remove();

  let reply=data?.data?.answer||"‚ö†Ô∏è Tidak ada respon";
  reply=reply.replace(/cici|ciciai/gi,"REZ‚Ä¢oneXD");

  session.history.push({role:"bot",text:reply});
  save();
  addMessage("bot",reply);

 }catch{
  typing.remove();
  addMessage("bot","‚ö†Ô∏è Server error");
 }
}

/* ===== VN USER NGOMONG ===== */
let recognition;
if("webkitSpeechRecognition" in window){
 recognition=new webkitSpeechRecognition();
 recognition.lang="id-ID";
 recognition.continuous=false;
 recognition.interimResults=false;

 recognition.onstart=()=>{
  addMessage("bot","üé§ Mendengarkan...");
 };

 recognition.onresult=(e)=>{
  let text=e.results[0][0].transcript;
  input.value=text;
  sendMessage();
 };

 recognition.onerror=()=>{
  addMessage("bot","‚ö†Ô∏è Mic error / izin ditolak");
 };
}

function startVoice(){
 if(!recognition){
  alert("Browser tidak mendukung VN");
  return;
 }
 recognition.start();
}

/* ===== AUTH ===== */
if(!localStorage.getItem("rezonexd_session")){
 location.href="./auth/login.html";
}

function logout(){
 localStorage.removeItem("rezonexd_session");
 location.href="./auth/login.html";
}
</script>

</body>
  </html>
