<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>REZâ€¢oneXD AI</title>

<style>
body{background:#0b1220;color:white;font-family:Arial;margin:0}
.header{display:flex;align-items:center;justify-content:space-between;background:#0f1629;padding:12px;font-weight:bold}
.icon{width:40px;height:40px;border-radius:50%;margin-right:8px}
.chat{padding:12px;height:75vh;overflow-y:auto}
.me{background:#3b7bfd;padding:10px;border-radius:12px;margin:8px 0;margin-left:auto;width:fit-content;max-width:85%}
.bot{background:#1f2a44;padding:10px;border-radius:12px;margin:8px 0;width:fit-content;max-width:85%}
.footer{display:flex;padding:10px;background:#0f1629;gap:6px}
input{flex:1;padding:10px;border-radius:8px;border:none;background:#0b1220;color:white}
button{padding:10px 14px;border-radius:8px;border:none;background:#3b7bfd;color:white}
.delete-btn{background:#ff4747}

pre{background:#0b1220;padding:10px;border-radius:8px;overflow:auto}
code{color:#7ee787}

html, body{height:100%}

/* DESKTOP */
@media (min-width:768px){
 body{
  background-image:url("https://img1.pixhost.to/images/11662/685570551_dikzz.jpg");
 }
}
/* MOBILE */
@media (max-width:767px){
 body{
  background-image:url("https://img1.pixhost.to/images/11662/685570521_dikzz.jpg");
 }
}
</style>
</head>

<body>

<div class="header">
 <div style="display:flex;align-items:center">
  <img src="https://img1.pixhost.to/images/10993/672136981_dikzz.jpg" class="icon">
  REZâ€¢oneXD AI Chat
 </div>
 <button class="delete-btn" onclick="clearSession()">Hapus Sesi</button>
 <button onclick="logout()" style="background:#ff9f43;color:black">Logout</button>
</div>

<div class="chat" id="chatBox"></div>

<div class="footer">
 <input id="input" placeholder="Ketik pesan...">
 <button onclick="sendMessage()">Kirim</button>
 <button onclick="speakLast()" style="background:#1dd1a1">VN</button>
</div>

<script>
const API = "https://romzi.vercel.app/ai/ciciai?query=";

const SYSTEM_PROMPT = `
Nama kamu REZâ€¢oneXD.
Kamu asisten AI milik Gx Dikzz.
Jangan pernah sebut nama Cici.
Kalau ditanya nama â†’ jawab: "Nama aku REZâ€¢oneXD, asisten AI milik Gx Dikzz."
`;

let session={history:[]};
const chatBox=document.getElementById("chatBox");
const input=document.getElementById("input");

/* ================= STORAGE ================= */
function load(){
 let s=localStorage.getItem("rezonexd_ai");
 if(s) session=JSON.parse(s);
 render();
}
load();

function save(){
 localStorage.setItem("rezonexd_ai",JSON.stringify(session));
}

function render(){
 chatBox.innerHTML="";
 session.history.forEach(m=>{
  addMessage(m.role==="user"?"me":"bot",m.text);
 });
 chatBox.scrollTop=chatBox.scrollHeight;
}

/* ================= MESSAGE ================= */
function addMessage(type,text){
 let d=document.createElement("div");
 d.className=type;

 if(text.includes("```")){
  d.innerHTML=text.replace(/```([\s\S]*?)```/g,
   "<pre><code>$1</code></pre>");
 }else{
  d.innerText=text;
 }
 chatBox.appendChild(d);
 chatBox.scrollTop=chatBox.scrollHeight;
}

/* ================= TYPEWRITER ================= */
function typeWriter(el,text,speed=15){
 let i=0;
 el.innerText="";
 let t=setInterval(()=>{
  if(i<text.length){
   el.innerText+=text.charAt(i);
   chatBox.scrollTop=chatBox.scrollHeight;
   i++;
  }else clearInterval(t);
 },speed);
}

/* ================= CLEAR ================= */
function clearSession(){
 session.history=[];
 localStorage.removeItem("rezonexd_ai");
 render();
 alert("Sesi direset!");
}

/* ================= IMAGE ================= */
async function generateImage(prompt){
 let d=document.createElement("div");
 d.className="bot";
 d.innerHTML="ðŸ–¼ï¸ Membuat gambar...";
 chatBox.appendChild(d);

 let img=`https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}`;
 d.innerHTML=`
 <div>${prompt}</div>
 <img src="${img}" style="max-width:100%;border-radius:12px;margin-top:6px">
 `;
 chatBox.scrollTop=chatBox.scrollHeight;
}

/* ================= SEND ================= */
async function sendMessage(){
 let text=input.value.trim();
 if(!text) return;
 input.value="";

 if(text.startsWith("/img ")){
  addMessage("me",text);
  generateImage(text.replace("/img ",""));
  return;
 }

 addMessage("me",text);
 session.history.push({role:"user",text});
 save();

 let typing=document.createElement("div");
 typing.className="bot";
 typing.innerText="â³ REZâ€¢oneXD sedang berpikir...";
 chatBox.appendChild(typing);

 let short=session.history.slice(-3)
  .map(m=>(m.role==="user"?"User: ":"AI: ")+m.text).join("\n");

 let query=SYSTEM_PROMPT+"\n"+short+"\nAI:";

 try{
  let res=await fetch(API+encodeURIComponent(query));
  let data=await res.json();
  typing.remove();

  let reply=data?.data?.answer||"âš ï¸ Tidak ada respon";
  reply=reply.replace(/cici|ciciai/gi,"REZâ€¢oneXD");

  let d=document.createElement("div");
  d.className="bot";
  chatBox.appendChild(d);

  session.history.push({role:"bot",text:reply});
  save();
  typeWriter(d,reply);

 }catch(e){
  typing.remove();
  addMessage("bot","âš ï¸ Server error");
 }
}

/* ================= VOICE ================= */
function speakLast(){
 let last=session.history.slice().reverse().find(m=>m.role==="bot");
 if(!last) return;
 let u=new SpeechSynthesisUtterance(last.text);
 u.lang="id-ID";
 speechSynthesis.speak(u);
}

/* ================= AUTH ================= */
if(!localStorage.getItem("rezonexd_session")){
 location.href="./auth/login.html";
}
function logout(){
 localStorage.removeItem("rezonexd_session");
 location.href="./auth/login.html";
}
</script>

</body>
</html>