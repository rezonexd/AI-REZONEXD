<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>REZ‚Ä¢oneXD AI</title>

<style>
body{background:#0b1220;color:white;font-family:Arial;margin:0}
.header{display:flex;align-items:center;justify-content:space-between;background:#0f1629;padding:12px;font-weight:bold}
.icon{width:40px;height:40px;border-radius:50%;margin-right:8px}
.chat{padding:12px;height:75vh;overflow-y:auto}
.me{background:#3b7bfd;padding:10px;border-radius:12px;margin:8px 0;margin-left:auto;width:fit-content;max-width:85%}
.bot{background:#1f2a44;padding:10px;border-radius:12px;margin:8px 0;width:fit-content;max-width:85%}
.footer{display:flex;padding:10px;background:#0f1629;gap:6px}
input{flex:1;padding:10px;border-radius:8px;border:none;background:#0b1220;color:white}
button{padding:10px 14px;border-radius:8px;border:none;background:#3b7bfd;color:white}
.delete-btn{background:#ff4747}
</style>

</head>
<body>

<div class="header">
 <div style="display:flex;align-items:center">
  <img src="https://img1.pixhost.to/images/10993/672136981_dikzz.jpg" class="icon">
  REZ‚Ä¢oneXD AI Chat
 </div>
 <button class="delete-btn" onclick="clearSession()">Hapus Sesi</button>
 <button onclick="logout()" style="background:#ff9f43;color:black">
 Logout
 </button>
</div>

<div class="chat" id="chatBox"></div>

<div class="footer">
 <input id="input" placeholder="Ketik pesan...">
 <button onclick="sendMessage()">Kirim</button>
</div>

<script>
const API = "https://romzi.vercel.app/ai/ciciai?query=";

// PROMPT SINGKAT ‚Äî tidak bikin request kepanjangan
const SYSTEM_PROMPT = `
Nama kamu REZ‚Ä¢oneXD.
Kamu asisten AI milik Gx Dikzz.
Jangan pernah sebut nama Cici.
Kalau ditanya nama ‚Üí jawab: "Nama aku REZ‚Ä¢oneXD, asisten AI milik Gx Dikzz."
`;

let session = {
 history:[]
};

const chatBox = document.getElementById("chatBox");
const input = document.getElementById("input");

function load(){
 let saved = localStorage.getItem("rezonexd_ai");
 if(saved) session = JSON.parse(saved);
 render();
}
load();

function save(){
 localStorage.setItem("rezonexd_ai", JSON.stringify(session));
}

function render(){
 chatBox.innerHTML = "";
 session.history.forEach(m=>{
 addMessage(m.role==="user"?"me":"bot", m.text);
 });
 chatBox.scrollTop = chatBox.scrollHeight;
}

function addMessage(type,text){
 let d=document.createElement("div");
 d.className=type;
 d.innerText=text;
 chatBox.appendChild(d);
 chatBox.scrollTop = chatBox.scrollHeight;
}

function clearSession(){
 session.history=[];
 localStorage.removeItem("rezonexd_ai");
 render();
 alert("Sesi direset!");
}

async function sendMessage(){
 let text=input.value.trim();
 if(!text) return;
 input.value="";

 addMessage("me",text);
 session.history.push({role:"user",text});
 save();

 let typing=document.createElement("div");
 typing.className="bot";
 typing.innerText="üé§ AI sedang merekam...";
 chatBox.appendChild(typing);

 // Kirim cuma sedikit history biar ga berat
 let shortHistory = session.history.slice(-3)
   .map(m => (m.role==="user"?"User: ":"AI: ")+m.text)
   .join("\n");

 let finalQuery = SYSTEM_PROMPT + "\n" + shortHistory + "\nAI:";

 try{
  let res=await fetch(API+encodeURIComponent(finalQuery));
  let data=await res.json();

  typing.remove();

  let reply = data?.data?.answer || "Maaf, AI tidak membalas";

  // pastikan ga berubah ke Cici
  reply = reply.replace(/Cici|Ciciai|CICI|cici/gi,"REZ‚Ä¢oneXD");

  session.history.push({role:"bot",text:reply});
  save();
  addMessage("bot",reply);

 }catch(e){
  typing.remove();
  let msg="‚ö†Ô∏è Server error / jaringan mati";
  session.history.push({role:"bot",text:msg});
  save();
  addMessage("bot",msg);
 }
}

 
if(!localStorage.getItem("rezonexd_session")){
 location.href="./auth/login.html";
  }
  
</script>


</body>
</html>
